<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fundamentals of General Relativity</title>
  <meta name="description" content=" This is a guide to the fundamentals of General Relativity and its applications in astrophysics and cosmology. Topics covered (or will be covered) include the equivalence principle, the concept of a geodesic, the metric tensor, the Einstein Field Equations, and a study of black holes as well as relativistic cosmology.
">

  
      <link rel="icon" type="image/svg+xml" href="https://jackysci.com/favicon.svg">
      <link rel="icon" type="image/png" href="https://jackysci.com/favicon.ico">
  

  
      <link rel="stylesheet" href="https://jackysci.com/site.css">
      <!--KaTeX-->
      <link rel="stylesheet" href="https://jackysci.com/katex/katex.min.css">

      <!--Inter-->
      <link rel="stylesheet" href="https://jackysci.com/inter/inter.css">
  

</head>

<body>

  <nav>
    <a href="/" class="active">Home</a>
    <!--incomplete about page
    <a href="about.html">About</a>
    -->
    <a href="https://jackysci.com/notes/">Notes</a>
    <a href="https://lightofhope.site/">Music</a>
    <a href="https://github.com/Songtech-0912">GitHub</a>
  </nav>

  
    <article class="post">
        <h1>Fundamentals of General Relativity</h2>
        
        <p id="print-notice">This page is print-friendly. Simply press Ctrl + P (or Command + P if you use a Mac) to print the page and download it as a PDF. <a href="https://forms.gle/msb5wKErDJCjeL5k6">Report an issue or error here</a>.</p>

        
        
        <!-- table of contents -->
        
        <details class="toc" id="toc" open>
        <summary>Table of contents</summary>
        <p class="toc-info">Note: it is highly recommended to navigate by clicking links in the table of contents! It means you can use the back button in your browser to go back to any section you were reading, so you can jump back and forth between sections!</p>
        <div>
            <ul>
            
                <li>
                    <a href="#mathematical-prerequisites">Mathematical prerequisites</a>
                    
                </li>
            
                <li>
                    <a href="#an-introduction-to-general-relativity">An introduction to General Relativity</a>
                    
                        <ul>
                            
                                <li>
                                    <a href="#the-newtonian-and-gr-regimes">The Newtonian and GR regimes</a>
                                </li>
                            
                                <li>
                                    <a href="#review-of-relativistic-physics-and-newtonian-gravity">Review of relativistic physics and Newtonian gravity</a>
                                </li>
                            
                                <li>
                                    <a href="#the-analogue-with-electromagnetism">The analogue with electromagnetism</a>
                                </li>
                            
                                <li>
                                    <a href="#einstein-s-dilemma-with-rotating-reference-frames">Einstein&#x27;s dilemma with rotating reference frames</a>
                                </li>
                            
                        </ul>
                    
                </li>
            
                <li>
                    <a href="#a-geometric-theory-of-physics">A geometric theory of physics</a>
                    
                        <ul>
                            
                                <li>
                                    <a href="#the-effects-of-spacetime-curvature-on-particle-trajectories">The effects of spacetime curvature on particle trajectories</a>
                                </li>
                            
                                <li>
                                    <a href="#manifolds-and-differential-geometry">Manifolds and differential geometry</a>
                                </li>
                            
                                <li>
                                    <a href="#introduction-to-the-metric">Introduction to the metric</a>
                                </li>
                            
                                <li>
                                    <a href="#the-inverse-metric">The inverse metric</a>
                                </li>
                            
                                <li>
                                    <a href="#paths-in-two-dimensional-spaces">Paths in two-dimensional spaces</a>
                                </li>
                            
                                <li>
                                    <a href="#transformation-of-coordinates-and-the-origin-of-tensors">Transformation of coordinates and the origin of tensors</a>
                                </li>
                            
                                <li>
                                    <a href="#intrinsic-and-extrinsic-coordinates">Intrinsic and extrinsic coordinates</a>
                                </li>
                            
                        </ul>
                    
                </li>
            
                <li>
                    <a href="#a-philosophical-interlude-the-nature-of-gravity">A philosophical interlude: the nature of gravity</a>
                    
                </li>
            
                <li>
                    <a href="#special-relativity-and-relativistic-electromagnetism">Special relativity and relativistic electromagnetism</a>
                    
                        <ul>
                            
                                <li>
                                    <a href="#an-quick-review-of-tensors-for-special-relativity">An quick review of tensors for special relativity</a>
                                </li>
                            
                        </ul>
                    
                </li>
            
                <li>
                    <a href="#higher-dimensional-spaces">Higher-dimensional spaces</a>
                    
                        <ul>
                            
                                <li>
                                    <a href="#curvature-as-physics">Curvature as physics</a>
                                </li>
                            
                        </ul>
                    
                </li>
            
            </ul>
        </div>
        </details>
        

        <!-- page content -->
        <p>This is a guide to the fundamentals of General Relativity and its applications in astrophysics and cosmology. Topics covered (or will be covered) include the equivalence principle, the concept of a geodesic, the metric tensor, the Einstein Field Equations, and a study of black holes as well as relativistic cosmology.</p>
<span id="continue-reading"></span>
<p>I thank <a href="https://faculty.rpi.edu/joel-giedt">Professor Giedt</a> at Rensselaer Polytechnic for teaching the GR course that made this guide possible.</p>
<h2 id="mathematical-prerequisites">Mathematical prerequisites</h2>
<p>This guide presumes strong knowledge of vector calculus, basic linear algebra, differential equations, electromagnetism, and classical mechanics (including Lagrangian and Hamiltonian mechanics). If any of them are unfamiliar to you, consult the below guides to learn/review these topics:</p>
<ul>
<li>For a review of calculus (in particular multivariable and vector calculus), see the <a href="https://jackysci.com/calculus-series/">calculus series</a></li>
<li>For a review of basic differential equations, see the <a href="https://jackysci.com/differential-equations/">introductory differential equations guide</a></li>
<li>For a review of electromagnetic theory, see the <a href="https://jackysci.com/electromagnetism/">fundamentals of electromagnetism guide</a> as well as the <a href="https://jackysci.com/classical-electromagnetism/">in-depth electromagnetism guide</a></li>
<li>For a review of partial differential equations, boundary-value problems, and Fourier series, and see the <a href="https://jackysci.com/intro-pdes/">PDEs guide</a></li>
<li>For a review of special relativity and tensors, see the <a href="https://jackysci.com/advanced-classical-mech/">advanced classical mechanics guide</a></li>
<li>For an <strong>optional</strong> review of quantum mechanics, see the <a href="https://jackysci.com/intro-quantum-phys/">introductory quantum mechanics guide</a> as well as the <a href="https://jackysci.com/quantum-mechanics/">in-depth quantum mechanics guide</a>. There <em>might</em> be a brief discussion on quantum gravity at the very end of this guide.</li>
</ul>
<h2 id="an-introduction-to-general-relativity">An introduction to General Relativity</h2>
<p>General Relativity (GR) is fundamentally a theory about gravity. More precisely it is a <em>geometric</em> theory of gravity. Even more precisely it is a <em>geometric theory of gravity based on the equivalence principle</em>. Ah, we are getting too far of ourselves here; but the point is that GR is a very complicated theory that <em>doesn't</em> make sense.</p>
<p>Which is a shame, because GR predicts fascinating phenomena: black holes, wormholes, the slowing of time by gravity, the beautiful bending of light by galaxies and stars, and so, so much more. And GR describes how our Universe evolves at the largest scales, telling us both about the Universe's past and its present, and even its future. It is mystical, beautiful, and perplexing at the same time. I hope that after reading to the end of this guide, this will be the impression that GR leaves on you.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/1/11/A_Horseshoe_Einstein_Ring_from_Hubble.JPG" alt="A picture taken by the Hubble space telescope, showing the phenomenon of gravitational lensing" /></p>
<p><em>Gravitational lensing by the galaxy LRG 3-757, taken by the Hubble Space Telescope. Source: <a href="https://commons.wikimedia.org/wiki/File:A_Horseshoe_Einstein_Ring_from_Hubble.JPG">Wikipedia</a></em></p>
<h3 id="the-newtonian-and-gr-regimes">The Newtonian and GR regimes</h3>
<p>General relativity is the most precise theory of gravity ever created - and indeed, it still is to this day, over a hundred years since it was first proposed. However, the precision of the theory is often not needed. Indeed, we are frequently able to describe gravitational phenomena using the Newtonian theory, which is sufficiently accurate for almost all applications in everyday life, from calculating ballistic trajectories to spacecraft orbits to even simulating the dynamics of galaxies.</p>
<p>It is only in cases of extremely strong gravitational fields and extreme astronomical events, such as around black holes, neutron stars, or binary black-hole/neutron-star mergers that general relativity plays a major role in gravitational interactions. We therefore can distinguish between two physical regimes: the <strong>Newtonian regime</strong>, comprising of all physical systems that can be adequately described by Newtonian gravity, and the <strong>GR regime</strong>, where Newtonian gravity becomes insufficient and general-relativistic effects dominate. Indeed, we may quantify when exactly general-relativistic effects matter by considering the dimensionless quantity $\phi_{GR}$, defined as:</p>
<p class="mathcell">
$$
\phi_{GR} = \frac{2GM}{c^2 R}
$$
</p>
<p>When $\phi_{GR} &gt; 1$, the effects of GR become evident and we are in the <em>GR regime</em>, whereas for $\phi_{GR} \ll 1$ the effects of GR are negligible and we are in the <em>Newtonian regime</em>. But note that since $\phi_{GR} \sim M$, $M$ must be very, very large for $\phi_{GR}$ to be larger than 1. Indeed, even for the Sun, which has a mass on the order of $\pu{10^{30} kg}$, we find that $\phi_{GR} \sim 10^{-8}$, meaning that the GR corrections to the predictions of Newtonian gravity are very, very small. It is only for supermassive black holes and similar ultra-massive (or ultra-dense) astronomical bodies that $\phi_{GR} \gg 1$, and general relativity becomes essential.</p>
<blockquote>
<p><strong>Note:</strong> Physically, $\phi_{GR}$ is equal to the Newtonian gravitational potential $\Phi$ divided by the speed of light. How this quantity is constructed will be something we'll discuss later.</p>
</blockquote>
<h3 id="review-of-relativistic-physics-and-newtonian-gravity">Review of relativistic physics and Newtonian gravity</h3>
<p>Most theories of physics grew out of a desire to explain phenomena that could not be described (or contradicted) prior theories; general relativity is no different. Indeed, to understand how GR arose, we must first take a look at the two theories that GR supersedes: <strong>special relativity</strong> and <strong>Newtonian gravity</strong>.</p>
<p>To start, special relativity is fundamentally a theory about how our conventional understanding of "space" and "time" is incorrect. This is a result of the fundamental postulate of special relativity: physical interactions <strong>cannot propagate faster</strong> than the speed of light, which we denote as $c$. Even more strangely, no matter how fast you are moving, you will always see light traveling at the <em>exact same speed</em> of $c$. For the laws of physics to be consistent (that is, to avoid any paradoxes), the result is that we find that time and space become <em>relative</em> concepts. Instead, a new concept of <strong>spacetime</strong> must be devised that supersedes our old notions of space and time. We find that spacetime can mathematically be described using the tools of <a href="https://en.wikipedia.org/wiki/Differential_geometry">differential geometry</a>, and thus special relativity is, in some sense, a geometric theory. However, most special relativistic calculations end up using only algebra (with a sprinkling of some calculus), turning away from a full differential geometry based approach.</p>
<p>Now, let us take a look at Newtonian gravity. Newtonian gravity is the classical (as in non-relativistic) theory of gravity, which is formulated in the laws of <strong>Newtonian mechanics</strong>. The heart of Newtonian gravity is the principle of <strong>universal gravitation</strong>. The principle can be stated as follows:</p>
<ol>
<li>All masses in the Universe attract each other by the <strong>force of gravity</strong></li>
<li>The gravitational force is <strong>instantaneous</strong>, regardless of the distance separating any two masses, and has <strong>infinite range</strong></li>
</ol>
<p>To state the first principle more precisely, the gravitational force exerted by mass $m_1$ at position $\mathbf{r}_1$ on some other mass $m_2$ at another position $\mathbf{r}_2$ is given by:</p>
<p class="mathcell">
$$
\mathbf{F}_{12} = -Gm_{1}m_{2} \frac{\mathbf{r}_{2} - \mathbf{r}_{1}}{|\mathbf{r}_{2} - \mathbf{r}_{1}|^3}
$$
</p>
<p>In principle, we can use this equation, along with Newton's second law $m \ddot{\mathbf{r}}_i = \sum \mathbf{F}_{ij}$, to precisely calculate the future positions and velocities of $n$ particles interacting gravitationally with each other. (In practice this is actually quite a difficult problem and requires powerful computers to solve adequately). However, the general idea holds: in Newton's theory <strong>gravity is an instantaneous force</strong>, meaning that Newtonian gravity (wrongly) predicts that gravitational interactions can travel faster than the speed of light, breaking special relativity!</p>
<p>For instance, Newtonian gravity predicts that a star 100 light years away would gravitationally act on Earth just as fast as our Sun, which would act just as fast as the Moon, and so forth. This idea does not hold up to experimental evidence, which can be demonstrated with a very similar thought experiment: in telescope images we have of distant galaxies, the vast majority of stars are long dead, but their light, emitted hundreds or even thousands of years ago, can still be seen. But if their gravitational influence was instant (as Newtonian gravity claims) while their light was not (as special relativity claims), then we would observe gravitational effects from the dead stars while their light had not yet reached us - "ghosts" that invisibly act across astronomical distances without any visible indication they actually exist. Clearly, this does not happen!</p>
<blockquote>
<p><strong>Note:</strong> Here, I am not discussing dark matter; I am just discussing <em>regular matter</em> as an illustrative example of where special relativity and Newtonian gravity contradict each other.</p>
</blockquote>
<p>In discussing special relativity and Newtonian gravity, the key takeaway is this: these two theories of physics are <strong>fundamentally incompatible</strong> with each other. Special relativity says that physical interactions can propagate at a <em>maximum speed</em> of $c$, but Newtonian relativity says that gravity is an <em>instantaneous force</em>. To resolve this conflict, we need <strong>general relativity</strong>.</p>
<h3 id="the-analogue-with-electromagnetism">The analogue with electromagnetism</h3>
<p>To try to have a basic intuitive understanding of how Newtonian gravity must be modified to incorporate the postulates of special relativity, we can consider the theory of <strong>electromagnetism</strong>. Electromagnetism and gravity are remarkably similar in many ways; both are long-range interactions (having theoretically infinite distance) and both follow inverse-square laws (Coulomb's law for electromagnetism and Newton's law for gravity). They are also highly <em>evident</em> because unlike the other fundamental interactions of nature (the strong and weak nuclear interactions), we see the effects of gravity and electromagnetism every day, in the forms of falling objects, bright flashes of light, and falling objects that cause bright flashes of light and tend to kill dinosaurs. Okay, maybe not the last one. But the point still stands: both are interactions we can <em>experience</em>, and this similarity can be used as an analogy to give us clues about the nature of gravity.</p>
<p>Historically, the development of electromagnetism originated in the study of <strong>electrostatics</strong>. Electrostatics governs the behavior of electric fields and electric charges that are <em>slow-moving</em>, and is the origin for <strong>Coulomb's law</strong>. In its original form, Coulomb's law describes the force between two point charges with charges $q_{1}, q_{2}$ and at locations $\mathbf{r}_{1}, \mathbf{r}_{2}$ as follows:</p>
<p class="mathcell">
$$
\mathbf{F}_{12} = \frac{q_{1} q_{2}}{4 \pi \varepsilon_{0}} \frac{\mathbf{r}_{2} - \mathbf{r}_{1}}{|\mathbf{r}_{2} - \mathbf{r}_{1}|^3}
$$
</p>
<p>Note how similar Coulomb's law is to Newton's law of universal gravitation. In modern physics, it is conventional to write out Coulomb's law not in its force form, but rather in the potential form using the electric scalar potential $V$, that is:</p>
<p class="mathcell">
$$
\ddot{\mathbf{r}} = -\frac{q}{m}\nabla V
$$
</p>
<p>Where the electric scalar potential takes the following form:</p>
<p class="mathcell">
$$
V(\mathbf{r}) = \sum_{i} \frac{q_i}{4 \pi \varepsilon_{0}} \frac{1}{|\mathbf{r}_i - \mathbf{r}|}
$$
</p>
<p>And the <strong>electric field</strong> takes the form:</p>
<p class="mathcell">
$$
\mathbf{E} = -\nabla  V
$$
</p>
<p>Coulomb's law is a good <em>approximation</em> for time-independent electric fields and charges moving slowly, but fails to apply once charges are moving close to the speed of light, or if the electric field is time-dependent. One finds that it is actually necessary to define another potential - the <strong>magnetic vector potential</strong> $\mathbf{A}$ - to describe the particle adequately. But wait, that's not all! We also find that for <strong>Lorentz invariance</strong> - that is, for the speed of light to be constant for all observers - we need to "package" the scalar potential and vector potential together into a new 4-dimensional potential, denoted as $A^\mu$ (I'll explain what this notation means soon). This 4-dimensional vector, also called a <em>4-vector</em>, looks like this:</p>
<p class="mathcell">
$$
A^{\mu} = \left( \frac{V}{c}, \mathbf{A} \right) = \begin{pmatrix}
V &#x2F; c \\
A_{x} \\
A_{y} \\
A_{z}
\end{pmatrix}
$$
</p>
<p>Indeed, we find that this 4-vector is what is necessary to <em>accurately</em> describe the electromagnetic field in the most general (relativistic and time-dependent) case. The evolution of this 4-vector is then given by the <strong>Maxwell equations</strong>, which, when written using Einstein's notation, are given by $\partial^\nu \partial_\nu A^\mu = \mu_0 J^\nu$. This generalization of the laws of non-relativistic electromagnetism is called <strong>relativistic electrodynamics</strong>, and permits classical electromagnetism to be fully consistent with relativity.</p>
<p>In the same idea, general relativity is a theory that takes Newtonian gravity and changes it - radically so - to be consistent with special relativity. Just like in electromagnetism, where the electric scalar potential $V$ had to be replaced by the four-dimensional potential $A^\mu$, in general relativity, the Newtonian gravitational potential $\Phi$ must be replaced by a <strong>tensor potential</strong> in GR, and is written as $g_{\mu \nu}$ (for now, think of a tensor as a "matrix"; more on that later). Since $g_{\mu \nu}$ has 10 independent components, this tensor potential can be thought of as a collection of 10 different potentials that are coupled with each other in a very complicated way. Indeed, if we write out $g_{\mu \nu}$ in matrix form, we have:</p>
<p class="mathcell">
$$
g_{\mu \nu}(\mathbf{r}, t) = \begin{pmatrix}
g_{00} &amp; g_{01} &amp; g_{02} &amp; g_{03} \\
g_{10} &amp; g_{11} &amp; g_{12} &amp; g_{13} \\
g_{20} &amp; g_{21} &amp; g_{22} &amp; g_{23} \\
g_{30} &amp; g_{31} &amp; g_{32} &amp; g_{33}
\end{pmatrix}
$$
</p>
<p>In this form, we can see that unlike $A^\mu$ for electromagnetism, which has "only" 4 components, $g_{\mu \nu}$ has 16 components(!) (although only 10 components are independent since $g_{\mu \nu}$ is symmetric). Each component is a sort of "potential" that depends on space and time, and interacts with the other components, which are also "potentials" (roughly-speaking). Crucially, just like $A^\mu$ for electromagnetism, $g_{\mu \nu}$ is <strong>Lorentz invariant</strong>, meaning that it ensures the speed of light is constant. Thus, we have now generalized gravity in a manner that is consistent with the</p>
<p>We'll see that in the Newtonian limit (weak gravity and slow-moving objects), $g_{00} = -\left( 1 + \dfrac{2\Phi}{c^2} \right)$ becomes the dominant component of the field and most of the other components can be more or less ignored. However, in the ultra-relativistic case, and whenever there is strong gravity, we need to consider <em>all</em> the components of $g_{\mu \nu}$ to describe gravity - effectively, we need to consider 10 different potentials!</p>
<p>Indeed, this is where GR and electromagnetism become very different, because unlike Maxwell's equations for EM, which are a system of linear PDEs, the fundamental equations of GR (the Einstein Field Equations) are a system of highly-nonlinear PDEs. Solving them is so difficult that finding an exact solution for <a href="https://en.wikipedia.org/wiki/Kerr_metric">non-trivial cases</a> can give you <a href="https://www.nzherald.co.nz/nz/canterbury-professor-first-kiwi-to-receive-einstein-medal/FNPXFRNJD77VSHLMTWI2YNJ4SY/">everlasting fame and glory</a> in the astrophysics community.</p>
<h3 id="einstein-s-dilemma-with-rotating-reference-frames">Einstein's dilemma with rotating reference frames</h3>
<p>General relativity also fixes another, less-evident issue with Newtonian gravity. Since Newtonian gravity comes from Newtonian mechanics, it comes along with all of its problems as well. In particular, accelerating reference frames are a famously-annoying issue in Newtonian gravity. As a demonstration, imagine you were standing aboard a bus that was moving forwards with some constant speed $v$. That is, until the bus rapidly brakes and comes to a stop. At that moment, you feel a "force" pushing on you (and might embarrassingly fall and drop all your things onto the floor). However, there is <em>no such force</em> - you are perfectly stationary with respect to the bus (unless you fall, but that's another thing altogether). So what was pushing on you, then? It was a <strong>fictitious force</strong> caused by the bus's acceleration. While you were stationary with respect to the bus, the bus was accelerating (more precisely, <em>decelerating</em>), and thus you feel the effect of that acceleration. To be more precise, you were present within a <strong>accelerating reference frame</strong>, and this led to your unfortunate experience of (possibly) falling.</p>
<p>Indeed, we could go with a much more complicated scenario. Try solving, for instance, the Newtonian equations of motion for a sliding block on rotating platform (DON'T!!! there are more productive uses of your time!!) and you will find terms corresponding to the fictitious <strong>Coriolis force</strong> and equally-fictitious <strong>centrifugal force</strong>, among others. We'll soon see that General relativity, <em>by its construction</em>, removes fictitious forces from the picture. Indeed, it tells us that <em>gravity</em> itself is a fictitious force, and that we can describe gravitational phenomena without needing to use the concept of forces at all. To summarize, while we are not able to rigorously-define either of these statements at the moment, GR posits that:</p>
<ul>
<li>There are <strong>no preferred reference frames</strong>: mathematically, this is governed by the fact that GR is formulated using mathematical objects called <strong>tensors</strong></li>
<li>Gravity is not a force, but rather a consequence of <strong>spacetime geometry</strong> which is described by the <strong>Einstein field equations</strong> using the mathematics of differential geometry</li>
</ul>
<h2 id="a-geometric-theory-of-physics">A geometric theory of physics</h2>
<p>When we say general relativity is a <strong>geometric theory</strong>, we want to be careful about what we mean by "geometry". In one sense, most of classical physics can be described as geometric in origin, but the geometry used was <strong>Euclidean geometry</strong> - a system formalized by Euclid over 2,000 years ago. General relativity, however, uses <strong>non-Euclidean geometry</strong>, which was developed by Gauss, Riemann, and other 19th- and 20th-century mathematicians. It is only with this unconventional mathematical paradigm that Einstein was able to model gravity geometrically.</p>
<p>General relativity, specifically, uses a form of non-Euclidean geometry that has the following features:</p>
<ul>
<li>The Universe is described by four-dimensional spacetime, which is a geometric object (technically, a <em>manifold</em>) that possesses <strong>curvature</strong></li>
<li>There may be curvature in time as well as space; that is, spacetime is <strong>dynamical</strong> (time-dependent)</li>
</ul>
<p>The presence of <strong>curvature</strong> in the geometry of spacetime is especially relevant, because it challenges one of the foundational axioms of Euclidean geometry. In Euclidean geometry, the shortest path between two points is a <strong>straight line</strong>. But in general relativity, even a particle attempting to travel along a "straight line" in curved spacetime ends up following a <em>curved path</em> due to the spacetime curvature. Thus, the shortest path between two points in general relativity is no longer (always) a straight line. Instead, it is a special curve called a <strong>geodesic curve</strong>, which is usually curved.</p>
<h3 id="the-effects-of-spacetime-curvature-on-particle-trajectories">The effects of spacetime curvature on particle trajectories</h3>
<p>Consider a ball thrown up and then allowed to fall back down to Earth under the influence of gravity. In relativity, the trajectory of a particle through space and time is known as its <strong>worldline</strong>. For our ball, the initial position of the ball is at $h = 0, t = 0$, where $h$ is the height of the ball above the ground. We may draw a <strong>spacetime diagram</strong> (a glorified graph) plotting the trajectory of the thrown ball, with the height on the $x$ axis and the time (multiplied by the speed of light, $c$) on the $y$ axis:</p>
<img class="diagram"
	
		src="/general-relativity/gr-curvature-plot.excalidraw.svg"
	
	alt="Diagram showing the trajectory of a thrown ball in weak (Newtonian) and strong (GR) gravity" />
<p>In weak gravity, there is approximately no spacetime curvature, and thus the trajectory of the ball is almost exactly a straight line, with nearly infinite slope (since $c \sim 10^8$ is such a large number). However, in strong gravity, there is non-negligible spacetime curvature, and thus the trajectory of the ball becomes a curve. From this basic example, we can already see that adding curvature dramatically changes the dynamics of particles travelling through spacetime.</p>
<blockquote>
<p><strong>Note:</strong> For another (more professional) visualization of the curvature of gravity, please see <a href="https://timhutton.github.io/GravityIsNotAForce/">this interactive website</a>.</p>
</blockquote>
<h3 id="manifolds-and-differential-geometry">Manifolds and differential geometry</h3>
<p>Since we use non-Euclidean geometry in general relativity, we must abandon the idea of straight lines and flat spaces and consider curved spaces. (Here, we use the word "space" as opposed to "plane" or "cube" or "line" to be more general, since an infinite line, infinite plane, and infinite cube are just special cases of Cartesian space).</p>
<p>To describe any sort of curved space, we need to introduce the idea of a <strong>manifold</strong>. A manifold is any space that is locally flat - that is to say, if we zoom in close enough, we can locally approximate it with Euclidean geometry. For instance, the Earth is roughly a manifold on human scales; indeed, while we obviously know that the Earth is (to a good approximation) a sphere, we do not perceive its curvature significantly on everyday distances, meaning that it <em>seems flat</em> to us. Generalizing this concept, we can say that an <em>infinitesimal portion</em> of a sphere can be regarded as flat, but a sphere is ultimately curved.</p>
<img class="diagram"
	
		src="/general-relativity/sphere-curvature.excalidraw.svg"
	
	alt="An illustration of a triangle on a sphere&#x27;s surface, showing how its angles add up to greater than 180 degrees." />
<p><em>A triangle placed on a sphere can have a sum of angles greater than 180 degrees!</em></p>
<p>Since a sphere is curved, it does not follow the typical rules of Euclidean geometry. Indeed, if we try to apply Euclidean geometry for shapes on the surface of a sphere of radius $a$, we find that we get completely unexpected results:</p>
<table><thead><tr><th></th><th>Sphere</th><th>Flat 2D space</th></tr></thead><tbody>
<tr><td>Sum of angles of an inscribed triangle</td><td>$\pi + A/a^2$ where $A$ is the area of the triangle</td><td>$\pi$</td></tr>
<tr><td>Circumference of an inscribed circle</td><td>$C = 2\pi a \sin(r/a)$ where $r = a\theta$</td><td>$C = 2\pi r$</td></tr>
</tbody></table>
<blockquote>
<p><strong>Note:</strong> It is also common to use the term <strong><a href="https://en.wikipedia.org/wiki/Solution_of_triangles#Solving_spherical_triangles">spherical triangle</a></strong> to refer to an inscribed triangle on a sphere, and likewise the term <strong><a href="https://en.wikipedia.org/wiki/Spherical_circle">spherical circle</a></strong> to refer to an inscribed circle on a sphere. Note that a spherical circle is <strong>defined</strong> as a curve of constant $\theta$ (colatitude); in geography, they are called <em>latitudinal lines</em> or <em>parallels</em>, and are used to describe circles on the (nearly) spherical Earth.</p>
</blockquote>
<p>These results stem from the fact that the surface of a sphere is a <strong>curved space</strong>. Since the surface is curved, we must use <em>non-Euclidean geometry</em>. However, note that in the limit that $a$ is large (that is, the sphere has a very large radius), $\sin(r/a) \approx r/a$ and therefore $C \approx 2\pi a\left( \frac{r}{a} \right) = 2\pi r$. This tells us that for very large spheres (like the Earth), the curvature becomes hardly noticeable and we can essentially ignore it and use the results of Euclidean geometry.</p>
<blockquote>
<p><strong>Note:</strong> We must be careful to note that we speak of the <em>surface of a sphere</em> as a curved space, but we do not say the <em>sphere itself</em> is a curved space. There is a major difference; the surface of a sphere is essentially <strong>two-dimensional</strong> (since a particle confined to move along the sphere can only travel in two directions - along the lines of longitude or latitude) while looking at a sphere is to consider a three-dimensional shape <em>embedded</em> within 3D Euclidean space. This is why the surface of a sphere is often called a <strong>2-sphere</strong>, since it is a 2D space.</p>
</blockquote>
<p>By considering <strong>non-Euclidean geometry</strong>, we can describe curved spaces as well as flat spaces. Indeed, we can categorize curved spaces into several categories, depending on their properties:</p>
<ul>
<li><strong>Hyperbolic space:</strong> negative curvature (e.g. surface of a hyperboloid)</li>
<li><strong>Flat space:</strong> zero curvature; the currently-accepted model of the universe suggests close to zero (spatial) curvature, though with non-zero curvature in the time dimension</li>
<li><strong>Elliptic space:</strong> positive curvature (e.g. surface of a sphere)</li>
</ul>
<p>The following diagram illustrates the properties of each of these categories of spaces:</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/4/44/Comparison_of_geometries.svg" alt="A visualization of several different types of curved spaces, including elliptic, flat, and hyperbolic spaces" /></p>
<p><em>Source: <a href="https://commons.wikimedia.org/wiki/File:Comparison_of_geometries.svg">Wikipedia</a></em></p>
<h3 id="introduction-to-the-metric">Introduction to the metric</h3>
<p>To understand how it could be possible that a sphere may have such drastically-different geometry as compared to what Euclidean geometry predicts, we must introduce the tools of <strong>differential geometry</strong>, which generalizes the concepts of Euclidean geometry to curved spaces. Differential geometry can be applied to any manifold, and uses the fact that if you zoom up close, any manifold is <em>locally flat</em> to describe highly-complex curved spaces as a combination of infinitesimally-flat patches.</p>
<p>As a basic introduction, recall Pythagoras's theorem in 2D space reads $s^2 = x^2 + y^2$. This tells us the distance $s$ between the origin and a point $(x, y)$ on the Cartesian 2D plane. Now, for two points $(x_1, y_1)$ and $(x_2, y_2)$, Pythagoras's theorem reads:</p>
<p class="mathcell">
$$
\Delta s^2 = (x_{2} - x_{1})^2 + (y_{2} - y_{1})^2 = \Delta x^2 + \Delta y^2
$$
</p>
<blockquote>
<p><strong>Note:</strong> Here we use the notation that $\Delta s^2 = (\Delta s)^2$. Thus, $\Delta x^2 = (\Delta x)^2$ and $\Delta y^2 = (\Delta y)^2$.</p>
</blockquote>
<p>Where $\Delta s$ is the distance between the two points. Now, we can generalize this result for <em>infinitesimal displacements</em> $dx, dy$ with:</p>
<p class="mathcell">
$$
ds^2 = dx^2 + dy^2
$$
</p>
<p>Unlike the prior two formulae, which was only valid for flat 2D space (Euclidean space), this expression for Pythagoras's theorem holds true for curved 2D spaces as well. For instance, consider a sphere of unit radius. As we discussed prior, the surface of a sphere is a 2D space, since a particle constrained to the surface of a sphere can only move in one of two directions (corresponding to the $\theta$ and $\phi$ coordinates in spherical coordinates). Unlike a plane, however, the surface of a sphere is a <em>curved space</em>, as we show in the below diagram:</p>
<img class="diagram"
	
		src="/general-relativity/spherical-line-element.excalidraw.svg"
	
	alt="Illustration of infinitesimal displacements on the surface of a sphere" />
<p><em>Infinitesimal displacements $dx, dy, ds$ on a unit sphere. Note: size of the displacements are exaggerated.</em></p>
<p>Indeed, we see that for infinitesimally-small displacements, Pythagoras's theorem holds true on the surface of the sphere, even though it doesn't hold true for finite displacements $\Delta x, \Delta y,\Delta s$. We have a special name for $ds$: it is called the <strong>line element</strong>. For the surface of the unit sphere, we can express the line element in the following form:</p>
<p class="mathcell">
$$
ds^2 = d \theta^2 + \sin^2 \theta d \phi^2
$$
</p>
<p>In the most general case, the line element in $n$ dimensions is given by the following expression:</p>
<p class="mathcell">
$$
ds^2 = \sum_{a}^n \sum_{b}^n g_{ab} dx^a dx^b
$$
</p>
<p>Where $g_{ab}$ is called the <strong>metric tensor</strong> (or just <em>metric</em> for short), and is a $(n \times n)$ matrix that describes the <em>geometry</em> of the space; it thus packages the information about the curvature of the space. Here, we use what is known as <strong>index notation</strong>, meaning that when we have a superscript or subscript index (like $dx^a$ or $g_{ab}$) we use the index to denote a <em>coordinate</em>. For instance, if we were using Cartesian coordinates $(x, y, z)$, then $dx^a = (dx, dy, dz)$ such that $dx^1 = dx$, $dx^2 = dy$ and $dx^3 = dz$. Meanwhile, if we were using cylindrical coordinates $(r, \phi, z)$ then $dx^a = (dr, d\phi, dz)$ so $dx^1 = dr$, $dx^2 = d\phi$, and $dx^3 = dz$. It is important to remember that in index notation, <strong>indices are NOT exponents!</strong> That is to say, $dx^3$ should be interpreted as "the infinitesimal displacement along the third <em>coordinate</em> ($z$)" rather than "$dx$ raised to the power of three".</p>
<p>With that clarified, we can now consider some examples of metrics. For instance, a metric tensor for a two-dimensional space takes the general form:</p>
<p class="mathcell">
$$
g_{ab} = \begin{pmatrix}
g_{11} &amp; g_{12} \\
g_{21} &amp; g_{22}
\end{pmatrix}
$$
</p>
<p>For 2D Euclidean space expressed in Cartesian coordinates, the metric is simply the 2D identity matrix:</p>
<p class="mathcell">
$$
g_{ab} = \begin{pmatrix}
1 &amp; 0 \\
0 &amp; 1
\end{pmatrix}
$$
</p>
<p>From which we can see that the only two nonzero components of the metric are $g_{11} = 1$ and $g_{22} = 1$. Thus, the line element is given by:</p>
<p class="mathcell">
$$
ds^2 = g_{11}  dx^1 dx^1 + g_{22} dx^2 dx^2 = dx^2 + dy^2
$$
</p>
<p>Note that in 3D Euclidean space, the metric is the 3D identity matrix:</p>
<p class="mathcell">
$$
g_{ab} = \begin{pmatrix}
1 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1
\end{pmatrix}
$$
</p>
<p>For which the nonzero elements are $g_{11} = 1$, $g_{22} = 1$, $g_{33} = 1$, and thus:</p>
<p class="mathcell">
$$
ds^2 = g_{11} dx^1 dx^1 + g_{22} dx^2 dx^2 + g_{33} dx^3 dx^3 = dx^2 + dy^2 + dz^2
$$
</p>
<p>Finally, let us take the example of 3D Euclidean space in spherical coordinates. The line element reads:</p>
<p class="mathcell">
$$
ds^2 = dr^2 + r^2 d \theta^2 + r^2 \sin^2 \theta d \phi^2
$$
</p>
<p>And the metric reads:</p>
<p class="mathcell">
$$
g_{ab} = \begin{pmatrix}
1 &amp; 0 &amp; 0 \\
0 &amp; r^2 &amp; 0 \\
0 &amp; 0 &amp; r^2 \sin^2 \theta
\end{pmatrix}
$$
</p>
<p>Using the metric, we can generalize quantities in conventional flat space to curved spaces. For instance, an infinitesimal patch of area $dA$ can be described in an arbitrary curved space with the <strong>area element</strong>:</p>
<p class="mathcell">
$$
d A = \sqrt{ g }\, dx^1 dx^2 = \sqrt{ g }\, d^2x
$$
</p>
<p>Where here, $g = \sqrt{ \det g_{ab} }$ is the determinant of the metric tensor $g_{ab}$, and $d^2 x = dx^1 dx^2$ is the product of the infinitesimal displacements in the two coordinate directions (for instance, $dx^1 = dx$ and $dx^2 = dy$ in 2D Euclidean space in cartesian coordinates, so $d^2 x = dx dy$). Meanwhile, an infinitesimal patch of volume $dV$ can be described in an arbitrary curved space with the <strong>volume element</strong>:</p>
<p class="mathcell">
$$
dV = \sqrt{ g }\, dx^1 dx^2 dx^3 = \sqrt{\det g }\, d^3 x
$$
</p>
<blockquote>
<p><strong>Note:</strong> It is very common to use the notation $\det g$ to represent the determinant of the metric, but the determinant of the metric is sometimes (confusingly!) also denoted as $g$. We will use the former notation and stick with it for consistency.</p>
</blockquote>
<p>Collectively, this allows us to find the areas and volumes of shapes in different spaces; one may use it, for instance, to calculate the area of a triangle lying on the surface of a sphere or hyperboloid, or that of a sphere in curved 3D space. One simply needs to integrate over the regions the shapes occupy to find their total volume $V_{shape}$ and total surface area $S_{shape}$, that is:</p>
<p class="mathcell">
$$
\begin{align*}
S_{shape} &amp;= \int \limits_\text{shape} dA = \int \limits_\text{shape} \sqrt{ g }\, dx^1 dx^2 \\
V_{shape} &amp;= \int \limits_\text{shape} dV = \int \limits_\text{shape} \sqrt{ g }\, dx^1 dx^2 dx^3 \\
\end{align*}
$$
</p>
<p>Similarly, one may find the length $s$ of some curve in an arbitrary space (for instance, the circumference of a circle on the surface of a sphere) by integrating over the line element:</p>
<p class="mathcell">
$$
s = \int \limits_\text{curve} \sqrt{ds^2}
$$
</p>
<p>We'll later see that the famous <a href="https://en.wikipedia.org/wiki/Einstein%E2%80%93Hilbert_action">Einstein-Hilbert action</a> in General Relativity can also be expressed in terms of the metric:</p>
<p class="mathcell">
$$
S = \frac{c^4}{16 \pi G} \int R \sqrt{ -g }\, d^4x
$$
</p>
<p>Where here, $S$ is the GR action and $R$ is a scalar-valued function that depends on the metric and its derivatives (it's called the <em>Ricci scalar</em>, but we'll get to that later). The essential feature of the metric is that it is the <strong>complete description</strong> of a space - whether flat or curved - and therefore, the metric is the essential quantity of interest in general relativity, since the curvature of spacetime, which is described by the metric, is <em>what we perceive as gravity</em>.</p>
<h3 id="the-inverse-metric">The inverse metric</h3>
<p>When we have the matrix form of the metric, the inverse metric can be obtained by just taking the matrix inverse. The simplest case is when the metric is purely diagonal; then, the inverse metric can be obtained by just taking the reciprocal of the metric</p>
<p class="mathcell">
$$
g_{ab} = \begin{pmatrix}
g_{11} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; g_{22} &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; g_{33} &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; \ddots &amp; 0  \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; g_{nn}
\end{pmatrix}
\quad \Rightarrow \quad
g^{ab} = \begin{pmatrix}
\frac{1}{g_{11}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; \frac{1}{g_{22}} &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; \frac{1}{g_{33}} &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; \ddots &amp; 0  \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{1}{g_{nn}}
\end{pmatrix}
$$
</p>
<p>Indeed, we find that a diagonal metric corresponds to an <strong>orthogonal coordinate system</strong>, which makes things much more convenient. For instance, it means that the the line element is given by a single sum over one coordinate $i$ rather than over two coordinates $i, j$:</p>
<p class="mathcell">
$$
\begin{align*}
ds^2 &amp;= g_{ii} dx^i dx^i \\
&amp;= g_{00} dx^0 dx^0 + g_{11} dx^1 dx^1 + g_{22} dx^2 dx^2 + \dots
\end{align*}
$$
</p>
<p>For instance, if we used coordinates $v_1, v_2, v_3, \dots, v_n$, then:</p>
<p class="mathcell">
$$
ds^2 = g_{11} dv_{1}^2 + g_{22} dv_{2}^2 + g_{33} dv_{3}^2 + \dots + g_{nn} dx_{n}^2
$$
</p>
<p>In the case of Cartesian coordinates, where $v_1 = x, v_2 = y, v_3 = z$, we have $g_{11} = g_{22} = g_{33} = 1$ and therefore we have:</p>
<p class="mathcell">
$$
ds^2 = dx^2 + dy^2 + dz^2
$$
</p>
<blockquote>
<p><strong>Note:</strong> We find that sometimes, the inverse metric can become singular (this occurs for polar coordinates and spherical coordinates, for instance). From a mathematical point of view, this means that the metric is defined everywhere except at these singularities, where we have a <strong>coordinate singularity</strong>; from a physical point of view, this doesn’t really matter, since we know that the singularities come purely from a choice of coordinates. The distinction between coordinate and physical singularities will become very important once we discuss black holes.</p>
</blockquote>
<h3 id="paths-in-two-dimensional-spaces">Paths in two-dimensional spaces</h3>
<p>One of the oldest math problems of all times is to find distance travelled along a curve — something that is very useful for anyone who wonders if they have the time to grab a coffee before heading to school (or work)! In mathematical terms, this is the classical problem of finding the <strong>arc length</strong> (or <em>path length</em>) of a curve — something that we can now tackle with our tools of differential geometry.</p>
<p>In flat (Euclidean) 2D space, we know that the metric is simply the 2D identity matrix, and so the line element is given by:</p>
<p class="mathcell">
$$
ds^2 = dx^2 + dy^2
$$
</p>
<p>To find the total length of some curve with endpoints $A = (x_1, y_1)$ and $B = (x_2, y_2)$, we must integrate over the line element:</p>
<p class="mathcell">
$$
s = \int_{A}^B ds = \int_{A}^B \sqrt{ dx^2 + dy^2 }
$$
</p>
<p>This integral cannot be solved directly, but we have some options. First, if we let $y = y(x)$, then $dy = y’(x) dx$ and thus we have:</p>
<p class="mathcell">
$$
s = \int_{A}^B \sqrt{ dx^2 + y&#x27;(x)^2 dx^2 } = \int_{x_{A}}^{x_{B}} \sqrt{ 1 + y&#x27;(x) }\, dx
$$
</p>
<p>Another option, which is often more useful is to parametrize $x, y$ in terms of some parameter $\tau$ (this can, although does not <em>have to</em>, represent time). Thus we have $dx = x'(t) dt$ and $dy = y'(t) dt$ and we have:</p>
<p class="mathcell">
$$
\begin{align*}
s &amp;= \int_{A}^B \sqrt{ dx^2 + dy^2 } \\
&amp;= \int_{A}^B \sqrt{ x&#x27;(t)^2 dt^2 + y&#x27;(t)^2 dt^2 } \\
&amp;= \int_{t_{A}}^{t_{B}} \sqrt{ x&#x27;(t)^2 + y&#x27;(t)^2 } dt
\end{align*}
$$
</p>
<p>These methods are simply the standard formulas for the arc length from single-variable calculus, and only apply in <strong>flat spaces</strong>. Let us now generalize the same methods to an arbitrary <strong>curved 2D space</strong>. It turns out that the general formula for the length of a curve to an arbitrary curved space is given by:</p>
<p class="mathcell">
$$
\begin{align*}
s &amp;= \int_{A}^B \sqrt{ ds^2 } \\
&amp;= \int_{A}^B \sqrt{ g_{ab} dx^a dx^b } \\
&amp;= \int_{A}^B \sqrt{ g_{ab} \left( \frac{dx^a}{d\tau}d\tau \right) \left( \frac{dx^b}{d\tau} d\tau \right) } \\
&amp;= \int_{\tau_{A}}^{\tau_{B}} d\tau \sqrt{ g_{ab} \frac{dx^a}{d\tau} \frac{dx^b}{d\tau} }
\end{align*}
$$
</p>
<p>For instance, let’s try to calculate the length of a path on a sphere. We know from before that:</p>
<p class="mathcell">
$$
ds^2 = R^2 d\theta^2 + R^2 \sin^2 \theta d\phi^2
$$
</p>
<p>In our case, the metric is given by:</p>
<p class="mathcell">
$$
g_{ab} = \begin{pmatrix}
R^2 &amp; 0 \\
0 &amp; R^2 \sin^2 \theta
\end{pmatrix}
$$
</p>
<p>For a sphere, the coordinates we use are $(\theta, \phi)$, and since $a, b$ sum over the coordinates, we have:</p>
<p class="mathcell">
$$
\begin{align*}
g_{ab} \frac{dx^a}{d\tau} \frac{dx^b}{d\tau} &amp;= g_{aa} \frac{dx^a}{d\tau} \frac{dx^a}{d\tau} \\
&amp;= g_{11} \left(\frac{d\theta}{d\tau}\right)^2 + g_{22} \left(\frac{d\phi}{d\tau}\right)^2 \\
&amp;= R^2 \left(\frac{d\theta}{d\tau}\right)^2 + R^2 \sin^2 (\theta) \left(\frac{d\phi}{d\tau}\right)^2
\end{align*}
$$
</p>
<p>Therefore, the arc length for $\tau \in [a, b]$ (where $\tau$ is some parameter; it can be time in a physical setting) is given by:</p>
<p class="mathcell">
$$
\begin{align*}
s &amp;= \oint ds \\
&amp;= \int_a^b d\tau \sqrt{g_{ab} \frac{dx^a}{d\tau} \frac{dx^b}{d\tau}} \\
&amp;= \int_a^b d\tau \sqrt{R^2 \left(\frac{d\theta}{d\tau}\right)^2 + R^2 \sin^2 (\theta) \left(\frac{d\phi}{d\tau}\right)^2} \\
&amp;= R\int_a^b d\tau \sqrt{\left(\frac{d\theta}{d\tau}\right)^2 + \sin^2 (\theta) \left(\frac{d\phi}{d\tau}\right)^2}
\end{align*}
$$
</p>
<p>If we supply the explicit forms of $\theta(\tau)$ and $\phi(\tau)$, we can therefore compute the arc length of any path on a sphere! For instance, we may want to find the circumference of the sphere at some fixed polar angle $\theta$ (on a globe this would be lines of constant latitude, known to navigators as <em>parallels</em>). Then, we treat $\theta$ as a constant (meaning that $\frac{d\theta}{d\tau} = 0$) while we let $\phi(\tau) = \tau$, meaning that $\phi(0) = 0$ and $\phi(2\pi) = 2\pi$ - allowing us to cover all the way around the sphere's circumference. Performing the integral gives us:</p>
<p class="mathcell">
$$
s = R\int_0^{2\pi} d\tau \sqrt{\sin^2 (\theta)\left(\frac{d\phi}{d\tau}\right)^2} = R\int_0^{2\pi} d\tau \sin \theta = 2\pi R \sin \theta
$$
</p>
<p>Notice that this is <em>not</em> the formula $s = 2\pi R$, as it would be on a circle of radius $R$, except at the equator ($\theta = \pi/2$). Of course it's not, because a sphere is curved! Thus we see that - as we expected - curvature causes <strong>distances to change</strong>.</p>
<blockquote>
<p><strong>Note:</strong> Here, $\theta$ is more accurately referred to as the <strong>colatitude</strong>, which is different from the <em>latitude</em> typically used in cartography and geography. In the case of the latitude $\alpha$, the formula becomes $s = 2\pi R \cos \alpha$.</p>
</blockquote>
<p>Now, we still haven’t answered a very important question: what if we only know the metric, but we <em>don’t know</em> the parametric forms of the curves? Can we use the formula for $s$ to work backwards to <em>determine</em> the trajectory $x^a(\tau)$ of a particle moving in a curved space? The answer, in fact, is <strong>yes</strong>. Answering this question is in fact one of the most important problems in general relativity, and will be the critical link between the abstract mathematics of differential geometry and the physics of gravity.</p>
<h3 id="transformation-of-coordinates-and-the-origin-of-tensors">Transformation of coordinates and the origin of tensors</h3>
<p>The coordinates we have been working with have primarily been the familiar coordinate systems of flat space: Cartesian, spherical, polar, and so forth. However, recall that the line element is a very general quantity that is also defined in curved spaces. Moreover, it can be expressed in <em>arbitrary</em> coordinate systems, and in fact it will often be <em>easier</em> for us to work with the line element in one coordinate system rather than another, especially in problems with symmetry.</p>
<p>To be able transform the line element into another coordinate system, recall that the general form of the line element is written as:</p>
<p class="mathcell">
$$
ds^2 = g_{ab} dx^a dx^b
$$
</p>
<p>Here, we need to use two transformations. First, we must transform the differentials as follows (where $j$ is summed over across all the coordinates):</p>
<p class="mathcell">
$$
dx^j = \frac{\partial x^i}{\partial x^j} dx^j
$$
</p>
<p>We must also transform the <em>components</em> of the metric, as follows (where $a, b$ are both summed over all the coordinates):</p>
<p class="mathcell">
$$
g_{ij} = \frac{\partial x^a}{\partial x^i} \frac{\partial x^b}{\partial x^j} g_{ab}
$$
</p>
<p>Then, the line element in our new coordinates takes the form:</p>
<p class="mathcell">
$$
ds^2 = g_{ij} dx^i dx^j
$$
</p>
<p>Notice that the general formula for $ds^2$ <strong>stays the same</strong>, with only a switch of indices. We therefore recognize that $ds^2$ is an <strong>invariant quantity</strong> since it stays the same, regardless of which space we are working in. Another invariant is the the <strong>Gaussian curvature</strong> $K$, which is given by:</p>
<p class="mathcell">
$$
\begin{align*}
K &amp;= \frac{1}{2g_{11}g_{22}} \bigg\{   - \frac{\partial^2 g_{11}}{\partial (x^2)^2} - \frac{\partial^2 g_{22}}{\partial(x^1)^2} \\ 
&amp;\qquad + \frac{1}{2g_{11}} \left[\frac{\partial g_{11}}{\partial (x^1)} \frac{\partial g_{22}}{\partial (x^1)} + \left( \frac{\partial g_{11}}{\partial (x^2)} \right)^2\right] + \frac{1}{2g_{22}} \left[ \frac{\partial g_{11}}{\partial (x^2)} \frac{\partial g_{22}}{\partial (x^2)} + \left( \frac{\partial g_{22}}{\partial (x^1)} \right)^2 \right]
\bigg\}
\end{align*}
$$
</p>
<p>Where $x^1, x^2$ are the coordinates used to describe the 2D space (they are not exponents!) and where $K$ is a combination of derivatives and components of the metric. Note that the Gaussian curvature is <strong>not</strong> defined for spaces that aren’t two-dimensional. We will explore a more general invariant quantity for spaces of arbitrary dimension, known as the <strong>Ricci scalar</strong>, once we get to curved 4D spacetime.</p>
<p>Another invariant quantity that we’ll study extensively is — you guessed it — the metric! While the <em>component form</em> of the metric depends on our choice of our coordinates, the metric itself is a universal mathematical object defined in <em>any space</em> (flat or curved), and the basic mathematical expressions involving the metric — including physical laws in GR — remain the same.</p>
<p>These invariant objects are known as <strong>tensors</strong>, and whether they are scalars (like $ds^2$ as well as the <em>Gaussian curvature</em> that we’ll soon see), vectors, matrices (like the metric), or something more exotic, they obey the special property that they <em>do not depend on the choice of coordinates</em>.</p>
<h3 id="intrinsic-and-extrinsic-coordinates">Intrinsic and extrinsic coordinates</h3>
<p>On the subject of coordinates, it is important to note that we actually have a choice of different coordinate systems to describe a given space:</p>
<ul>
<li>We can describe a space in terms of its <em>intrinsic coordinates</em>; that is, the coordinates that a particle “living” in the space (constrained to move within the space) would use</li>
<li>We can also describe a space in terms of <em>extrinsic coordinates</em>; that is, the coordinates of the space that it is embedded in</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Intrinsic coordinates are also known as <strong>Gaussian coordinates</strong> since Gauss was one of the first mathematicians who studied curved spaces.</p>
</blockquote>
<p>For example, we know that a sphere of radius $R$ is embedded in 3D space, where we have the <em>extrinsic coordinates</em> $(x, y, z)$. The metric of the embedding space (the space where the sphere “curves outwards” into) is simply that of 3D Euclidean space:</p>
<p class="mathcell">
$$
ds^2 = dx^2 + dy^2 + dz^2
$$
</p>
<p>Where the equation of a sphere is given by:</p>
<p class="mathcell">
$$
x^2 + y^2 + z^2 = R^2
$$
</p>
<p>But assume that you were an ant living on the surface of a sphere. You could never leave the sphere (let’s ignore any advanced ant-flying technology), and would be forever stuck on the sphere. Therefore, it would be more natural to use the <em>intrinsic coordinates</em> $(\theta, \phi)$ to represent your position on the surface of a sphere. Assuming that you were (somehow) an ant with unimaginable intelligence, you could describe the 2D space on the surface of a sphere with the following metric:</p>
<p class="mathcell">
$$
ds^2 = R^2 d\theta^2 + R^2 \sin^2 \theta d\phi^2
$$
</p>
<p>To relate the <em>intrinsic coordinates</em> on the sphere’s 2D surface with the <em>extrinsic coordinates</em> of the embedding space (Euclidean 3D space), we can use the following coordinate transformations:</p>
<p class="mathcell">
$$
\begin{align*}
x &amp;= R \sin \theta \cos \phi \\
y &amp;= R \sin \theta \sin \phi \\
z &amp;= R \cos \theta
\end{align*}
$$
</p>
<p>Note that we can then compute the differentials $dx, dy, dz$ as follows:</p>
<p class="mathcell">
$$
\begin{align*}
dx &amp;= \frac{\partial x}{\partial \theta} d\theta + \frac{\partial x}{\partial \phi} d\phi \\
&amp;= R \cos \theta \cos \phi d\theta -R \sin \phi \sin \theta d\phi \\
dy &amp;= \frac{\partial y}{\partial \theta} d\theta + \frac{\partial y}{\partial \phi} d\phi \\
&amp;= R \sin \phi \cos \theta d\theta + R \sin \theta \cos \phi d\phi \\
dz &amp;= \frac{\partial z}{\partial \theta} d\theta + \cancel{ \frac{\partial z}{\partial \phi} d\phi }^0 \\
&amp;= -R \sin \theta d\theta
\end{align*}
$$
</p>
<p>Substituting everything into the Euclidean 3D metric (the metric of the embedding space), we have:</p>
<p class="mathcell">
$$
\begin{align*}
ds^2 &amp;= dx^2 + dy^2 + dz^2 \\
&amp;= (R \cos \theta \cos \phi d\theta -R \sin \phi \sin \theta d\phi)^2 \\
&amp;\qquad + (R \sin \phi \cos \theta d\theta + R \sin \theta \cos \phi d\phi)^2 \\
&amp;\qquad + (-R \sin \theta d\theta)^2 \\
&amp;= R^2 d\theta^2 + R^2 \sin^2 d\phi^2
\end{align*}
$$
</p>
<p>Which is simply the metric of the surface of a sphere! Furthermore, we note that if we substitute our coordinate conversions of $x, y, z$ in terms of $\theta$ and $\phi$, we find that:</p>
<p class="mathcell">
$$
\begin{align*}
x^2 + y^2 + z^2 &amp;= 
(R \sin \theta \cos \phi)^2 + (R \sin \theta \sin \phi)^2 \\
&amp;\qquad+ (R \cos \theta)^2 \\
&amp;= R^2 \sin^2 \theta \cos^2 \phi + R^2 \sin^2 \theta \sin^2 \phi + R^2 \cos^2 \theta \\
&amp;= R^2 \sin^2 \theta \underbrace{ (\cos^2 \phi + \sin^2 \phi) }_{ 1 } + R^2 \cos^2 \theta \\
&amp;= R^2 \underbrace{ (\sin^2 \theta + \cos^2 \theta) }_{ 1 } \\
&amp;= R^2
\end{align*}
$$
</p>
<p>Which gives us $x^2 + y^2 + z^2 = R^2$, precisely the equation of a sphere! Thus we see that the geometric description of a space embedded in some higher-dimensional space is <strong>equivalent</strong>. This is also true for the <strong>hyperbolic space</strong>, the 2D that describes the surface of a 3D <a href="https://en.wikipedia.org/wiki/Hyperboloid">hyperboloid</a>. In the coordinates $(\xi, \phi)$, the metric is given by:</p>
<p class="mathcell">
$$
g_{ab} = \begin{pmatrix}
R^2 &amp; 0 \\
0 &amp; R^2 \sinh^2 \chi
\end{pmatrix}
$$
</p>
<p>For which the line element takes the form:</p>
<p class="mathcell">
$$
ds^2 = R^2 d\chi^2 + R^2 \sinh^2 \chi d\phi^2
$$
</p>
<p>When embedded in Euclidean 3D space, the equation of a hyperboloid reads:</p>
<p class="mathcell">
$$
x^2 + y^2 - z^2 = -1
$$
</p>
<p>We can find the coordinate conversions in the same manner as for the 2D sphere, although in this case we will be using the <em>hyperbolic functions</em> instead of the trigonometric functions.</p>
<h2 id="a-philosophical-interlude-the-nature-of-gravity">A philosophical interlude: the nature of gravity</h2>
<p>Gravity is a bit of an oddball when it comes to the four fundamental interactions of nature (the gravitational, electromagnetic, strong, and weak interaction). On one hand, gravity <em>seems</em> to be like electromagnetism in that it is a long-ranged force that propagates at the speed of light. After all, gravity is classically described by the <strong>gravitational potential</strong> $\Phi$, which has the form:</p>
<p class="mathcell">
$$
\Phi \sim \frac{1}{r}
$$
</p>
<p>This is very similar to the <strong>electric potential</strong>, which also varies by the inverse of the distance. By contrast, the strong force can be modelled by the <strong>Yukawa potential</strong>, which is given by:</p>
<p class="mathcell">
$$
V_\text{strong}(r) \sim \frac{e^{-r&#x2F;\lambda}}{r}
$$
</p>
<p>Where $\lambda$ is the Compton wavelength of the pion (the carrier particle for the strong force), which characterizes the range of the strong interaction. Since the Yukawa potential falls off so quickly with distance, we say it is a <strong>short-ranged force</strong>. The same is true for the weak force; its carrier particles are the W and Z bosons, which have even shorter Compton wavelengths, and therefore fall off even more rapidly.</p>
<p>However, unlike electromagnetism, gravity is <strong>extremely weak</strong> (by around 36 orders of magnitude!) Therefore, gravity is essentially negligible for the majority of particle physics experiments, and its effects are only visible on astronomical scales. In our solar system, precision experiments can be done to measure general-relativistic effects. At Earth’s orbit, a rough estimate of the strength of gravity can be found from the solar mass $M_\odot \approx \pu{2E30 kg}$ and the Earth’s orbit $R_\oplus \sim \pu{1.5E8 km}$, giving us:</p>
<p class="mathcell">
$$
\frac{2GM_\odot}{c^2 R_\oplus} \sim 10^{-8}
$$
</p>
<p>While this is small, the effects of general relativity accumulate over the centuries (particularly for Mercury, the planet closest to the Sun), leading to a phenomenon known as the <a href="https://aether.lbl.gov/www/classes/p10/gr/PrecessionperihelionMercury.htm">perihelion precession of Mercury</a>.</p>
<p>Another physical context in which it is important to consider the effects of GR is when we consider <strong>stellar collapse</strong>. When a star of sufficient mass dies, it collapses inwards, leading to a supernova and the formation of either a neutron star or a black hole. These processes are described by the <a href="https://en.wikipedia.org/wiki/Tolman%E2%80%93Oppenheimer%E2%80%93Volkoff_equation">Tolman–Oppenheimer–Volkoff equation</a>, which is derived directly from general relativity. We also see quasars, which are some of the most intense radiation sources in the Universe, thought to be the result of accretion disks around supermassive black holes at the center of galaxies.</p>
<h2 id="special-relativity-and-relativistic-electromagnetism">Special relativity and relativistic electromagnetism</h2>
<p>To understand general relativity, we must first consider its “spiritual predecessor” — the theory of <strong>special relativity</strong>. Interestingly enough, the origins of special relativity have nothing to do with gravity; they actually originate in electromagnetism. Specifically, the key insight that led to the development of special relativity was a peculiar feature of Maxwell’s equations, the fundamental equations of electromagnetism. In Gaussian units (an antiquated system of units, but still commonly used in high-energy physics), they take the form:</p>
<p class="mathcell">
$$
\begin{align*}
\nabla \cdot \mathbf{E} &amp;= 4\pi \rho \\
\nabla \cdot \mathbf{B} &amp;= 0 \\
\nabla \times \mathbf{E} + \frac{1}{c} \frac{\partial \mathbf{B}}{\partial t} &amp;= 0 \\
\nabla \times \mathbf{B} - \frac{1}{c} \frac{\partial \mathbf{E}}{\partial t} &amp;= \frac{4\pi}{c}\mathbf{J}
\end{align*}
$$
</p>
<p>Notice how the only constant that appears in Maxwell’s equations is $c$, the speed of light. But contrary to the expectations of physical, Maxwell’s equations predicted $c$ to be <strong>identical</strong> no matter the observer’s reference frame. This meant that whether you were stationary along the Earth or blasting through a window at 99% of the speed of light, the speed of light would always be the <strong>same</strong>!</p>
<p>The constant speed of light defied classical expectations, which assumed that velocities would add. If you were travelling at speed $v$ relative to the ground, you observed a light ray travelling at speed $c$, classical physics would predict that the speed of light with respect to the ground $c’$ would be given by:</p>
<p class="mathcell">
$$
c&#x27; = v + c
$$
</p>
<p>This, of course, is in <strong>direct contradiction</strong> with the predictions of Maxwell’s equations. Einstein’s solution to resolving this paradox was profound, and extremely radical. He said that <strong>time and space</strong> are no longer absolute, but rather, they are <em>relative concepts</em> that are perceived differently by each observer (more generally, dependent on the <em>chosen coordinates</em>). Rather, it is necessary to consider <strong>four-dimensional spacetime</strong>, the fusion of space and time, as the background over which all events in the Universe occur.</p>
<blockquote>
<p><strong>Note:</strong> We won’t go over special relativity much; for more information see the <a href="https://jackysci.com/special-relativity/">special relativity guide</a>.</p>
</blockquote>
<h3 id="an-quick-review-of-tensors-for-special-relativity">An quick review of tensors for special relativity</h3>
<p>Since relativity (both special and general relativity) demand that we must treat time and space as relative concepts in spacetime, we need to define <strong>coordinate-independent objects</strong> to describe physical quantities that “live” in spacetime — these are <strong>tensors</strong>.</p>
<blockquote>
<p><strong>Note:</strong> We will go pretty fast through tensors here and it may be a bit too fast-paced for beginners. A more gentle guide to tensors can be found <a href="https://handbook.elaraproject.org/specifics/mathematical-physics/tensor-analysis.html">on this page</a>.</p>
</blockquote>
<p>Tensors are written in the index notation that we have shown previously, but in spacetime, we typically use Greek indices (like $\mu, \nu$, etc.) to show that they exist in 4D spacetime. For instance, the 4-position (the 4D generalization of the 3D position vector) is written as:</p>
<p class="mathcell">
$$
x^\mu = \begin{pmatrix}
ct \\ x \\ y \\ z
\end{pmatrix} = \begin{pmatrix}
ct \\ \mathbf{x}
\end{pmatrix}, \quad \mu = 0, 1, 2, 3
$$
</p>
<p>Any event in the Universe — that is, anything that happens in the Universe — can be assigned a <strong>4-position</strong> in spacetime. We can transform between two 4-positions (given by $x^\nu$ and $x’^\mu$, where the primed coordinates indicate the coordinates within another reference frame) with the <strong>Lorentz transformations</strong>, which can be written in matrix form as:</p>
<p class="mathcell">
$$
\Lambda^\mu{}_{\nu} = \begin{pmatrix}
\gamma &amp; -\gamma v&#x2F;c &amp; 0 &amp; 0 \\
-\gamma v&#x2F;c &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}
$$
</p>
<p>Where $\gamma \equiv (1 - (v/c)^2)^{-1/2}$ is known as the <strong>Lorentz factor</strong>, and $\gamma \approx 1$ for “slow” objects (that is, $v \ll c$). In tensor notation, the Lorentz transformations can be written as:</p>
<p class="mathcell">
$$
x&#x27;^\mu = \Lambda^\mu{}_{\nu} x^\nu
$$
</p>
<p>Note that this is actually just a special case of a more general transformation law in GR, which is given by:</p>
<p class="mathcell">
$$
x^\mu = f^\mu(x^\nu)
$$
</p>
<p>Where $f^\mu$ can be some nonlinear function. It is more typical to use the differential form, given by:</p>
<p class="mathcell">
$$
dx^\mu = \frac{\partial f^\mu}{\partial x^\nu} dx^\nu
$$
</p><h2 id="higher-dimensional-spaces">Higher-dimensional spaces</h2>
<p>Before we go from special relativity to general relativity, we want to first consider a description of higher-dimensional spaces. For instance, we can consider the space of a <strong>3-sphere</strong> (that is, the surface of a 4-dimensional sphere). To start, the extrinsic description of a 3-sphere is given by:</p>
<p class="mathcell">
$$
x^2 + y^2 + z^2 + w^2 = R^2
$$
</p>
<p>We can write it in terms of <strong>intrinsic coordinates</strong> $\psi, \theta, \phi$, which are given by:</p>
<p class="mathcell">
$$
\begin{align*}
x &amp;= R \sin \psi \sin \theta \cos \phi \\
y &amp;= R \sin \psi \sin \theta \sin \phi \\
z &amp;= R \sin \psi \cos \theta \\
w &amp;= R \cos \psi
\end{align*}
$$
</p>
<p>And where:</p>
<p class="mathcell">
$$
\begin{align*}
\psi &amp;\in [0, \pi] \\
\theta &amp;\in [0, \pi] \\
\phi &amp;\in [0, 2\pi]
\end{align*}
$$
</p>
<p>From which we can find that the metric is given by:</p>
<p class="mathcell">
$$
ds^2 = R^2 d\psi^2 + R^2\sin^2 \psi  d\theta^2 + R^2 \sin^2 \theta d\phi^2
$$
</p>
<p>It can be shown that the determinant of the metric $\det g_{\mu \nu}$ is given by $g = R^6 \sin^4 \psi \sin^2 \theta$, from which we can find that $\sqrt{\det g} = R^3 \sin^2 \psi \sin \theta$. The volume element is thus given by:</p>
<p class="mathcell">
$$
\begin{align*}
dV = \sqrt{\det g}~ dx\, d\psi\, d\theta\, d\phi
\end{align*}
$$
</p>
<p>Thus, by integrating over the volume element, we can find the total volume of a 4D sphere:</p>
<p class="mathcell">
$$
\begin{align*}
V &amp;= \int dV \\ &amp;= R^3 \int_{0}^\pi d\psi \sin^2 \psi \int_{0}^\pi d\theta \sin \theta \int_{0}^{2\pi} d\phi \\
&amp;= 2\pi^2 R^3
\end{align*}
$$
</p>
<p>We can also consider the metric of a 3D hyperbolic space (that is, the surface of a 4D version of a hyperboloid, also known as a <em><a href="https://en.wikipedia.org/wiki/Pseudosphere">pseudosphere</a></em>). The intrinsic coordinates $\eta, \theta, \phi$ are related to the extrinsic coordinates $x, y, z, w$ is given by:</p>
<p class="mathcell">
$$
\begin{align*}
x &amp;= R \sinh \eta \sin \theta \cos \phi \\
y &amp;= R \sinh \eta \sin \theta \sin \phi \\
z &amp;= R \sinh \eta \cos \theta \\
w &amp;= R \cosh \eta
\end{align*}
$$
</p>
<p>Where:</p>
<p class="mathcell">
$$
\begin{align*}
\eta &amp;\in [-\infty, \infty] \\
\theta &amp;\in [0, \pi] \\
\phi &amp;\in [0, 2\pi]
\end{align*}
$$
</p>
<p>The metric can be written in the forms:</p>
<p class="mathcell">
$$
\begin{align*}
ds^2 &amp;= dx^2 + dy^2 + dz^2 - dw^2 \\
&amp;= R^2 d \eta^2 + R^2 \sinh^2 \eta d\theta^2 + R^2 \sin^2 \theta d\phi^2
\end{align*}
$$
</p>
<p>We can use the same methods to compute the volume element $dV$, but note that the total volume is infinite, since $\eta \in [-\infty, \infty]$. That is:</p>
<p class="mathcell">
$$
\int dV = \infty
$$
</p>
<p>The <strong>general metric</strong> for the 3D spaces of constant curvature (which are embedded in a 4-dimensional space) can be written as:</p>
<p class="mathcell">
$$
ds^2 = R^2 d\chi^2 + \frac{R^2}{k} \sin^2 (\sqrt{ k }\chi) d\Omega^2, \quad d\Omega^2 \equiv d\theta^2 + \sin^2 \theta d\phi^2
$$
</p>
<blockquote>
<p><strong>Note:</strong> It is useful to note here that $i = \sqrt{-1}$ and $\sin^2 i\chi = -\sin^2 \chi$. That is to say, the hyperbolic functions are essentially the trigonometric functions with an imaginary argument.</p>
</blockquote>
<p>For $k = 0$, we have flat space $\mathbb{R}^3$, while for $k = 1$ we have the 3-sphere and for $k = -1$ we have the pseudosphere. The three are related because the pseudosphere can be thought of as a sphere with <strong>imaginary radius</strong>, while flat space can be thought of as a sphere with <strong>infinite radius</strong>.</p>
<p>While this may all seem to be highly-abstract mathematics, there are <em>actual applications</em> of higher-dimensional curved spaces. For instance, cosmological models often use the following metric to describe the spatial curvature of the Universe:</p>
<p class="mathcell">
$$
ds^2 = R^2 \frac{d\xi^2}{1 - k \xi^2} + R^2 \xi^2 d\Omega^2
$$
</p>
<p>We will see later that this metric is essentially a spatial “slice” of the <a href="https://en.wikipedia.org/wiki/Friedmann%E2%80%93Lema%C3%AEtre%E2%80%93Robertson%E2%80%93Walker_metric">FLRW metric</a>, which is the standard cosmological model of the Universe; in the FLRW metric, we typically use the letter $r$ rather than $\xi$ and incorporate a time-dependent radius, such that $R = R(t)$. In the case $k = 0$ we have a flat, spatially-infinite Universe, while $k &gt; 0$ and $k &lt; 0$ gives us a finite Universe. Current empirical data suggests that $k$ is very, very small for the actual Universe, meaning that the Universe has a very little 3D curvature. It is still debated whether $k = 0$ is indeed true, which would tell us whether the Universe is finite or infinite.</p>
<p>Finally, we will briefly mention that if we allow for the coordinates to be complex-valued, we can describe the higher-dimensional spaces often used in string theory. A 6D example of such a space is known as a <a href="https://en.wikipedia.org/wiki/Calabi%E2%80%93Yau_manifold">Calabi-Yau manifold</a> and is widely studied; however, it is outside the scope of this guide.</p>
<h3 id="curvature-as-physics">Curvature as physics</h3>
<p>Why do we care so much about curved spaces in higher dimensions that we can’t see? It is because in GR, <em>geometry literally is gravity</em>. The gravitational field is the metric tensor $g_{\mu \nu}$. Mass, energy, momentum, and other matter fields together affects the gravitational field, which manifests as the curvature of spacetime. Correspondingly, the curvature of spacetime lead to deviations from straight paths in curved space, as we saw in our discussion of paths in curved spaces. As the famous physicist John Archibald Wheeler surmised:</p>
<blockquote>
<p>“Spacetime tells matter how to move; matter tells spacetime how to curve.” - <strong>John Archibald Wheeler</strong></p>
</blockquote>
<p>The consequences of spacetime curvature are profound; light becomes bent, distances are stretched and shortened, and gravity slows down time. Indeed, understanding the phenomena that arise from the curvature of spacetime forms the essence of general relativity!</p>

        
        <a id="jump-toc-btn" href="#toc">Show table of contents</a>
        <a href="/notes" class="return-link">Back to all notes</a>
        
    </article>

    <!-- We load KaTeX last for performance reasons -->
    <script defer src="https://jackysci.com/katex/katex.min.js"></script>
    <script defer src="https://jackysci.com/katex/contrib/auto-render.min.js"></script>
    <script defer src="https://jackysci.com/katex/contrib/mhchem.min.js"></script>
    <script defer src="https://jackysci.com/katex/contrib/copy-tex.min.js"></script>
    <script defer>
    function renderMath(element) {
        // renders math using KaTeX in a particular element
        renderMathInElement(element, {
          // customised options
          // • auto-render specific keys, e.g.:
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
          ],
          // • rendering keys, e.g.:
          throwOnError : false
        });
    }
    </script>
    
    <script defer>
        var toc = document.getElementById("toc");
        var tocPos = toc.offsetTop + toc.offsetHeight;
        var tocBtn = document.getElementById("jump-toc-btn");

        // return the top and bottom coordinates of the
        // user's position on the page
        function getViewport() {
            var scrollPosTop = document.documentElement.scrollTop;
            var scrollPosBottom = scrollPosTop + window.innerHeight;
            return scrollPosTop, scrollPosBottom
        }

        // for performance reasons, we **only** render a certain
        // number of equations that the viewer is actually viewing
        function VisibleMathRenderer(config) {
            /*
            Renders only a limited number of equations on page load
            to avoid poor performance
             Params:
                lastRenderedEquation: the most recently rendered equation.
                        when this goes out of view, equations under it are rendered. 
            */
            var startElement = config.startElement
            var maxEquations = config.maxEquations ? config?.maxEquations : 30;
            this.startElement = startElement
            this.maxEquations = maxEquations
            // we wait until the user scrolls past the starting/
            // ending elements to start rendering the whole page
            this.canRenderWholePage = false;
            this.pageRendered = false;
            this.lastRenderedTopEquation = null;
            this.lastRenderedBottomEquation = null;

            this.render = function() {
                renderMath(this.startElement);
                // render previous 25 and following 25 equations
                var prev = this.startElement.previousElementSibling;
                for (i = 0; i < this.maxEquations / 2; i++) {
                    // if there are no elements left prior to the element
                    if (prev == null) {
                        break;
                    }
                    renderMath(prev);
                    prev = prev.previousElementSibling;
                }
                // store our last rendered equations
                // we'll track scroll position later to
                // check when the rest of the page should be rendered
                this.lastRenderedTopEquation = prev;
                console.log(this.lastRenderedTopEquation)

                var next = this.startElement.nextElementSibling;
                for (i = 0; i < this.maxEquations / 2; i++) {
                    // if there are no elements left following the element
                    if (next.nextElementSibling == null) {
                        break;
                    }
                    renderMath(next);
                    next = next.nextElementSibling;
                }
                this.lastRenderedBottomEquation = next;
                // now allow rendering the rest of the equations
                this.canRenderWholePage = true;
            }

            // render all math on the whole page
            this.renderMathOnPage = function() {
                // don't run until preliminary tasks
                // are done so that the whole page
                // can/should be rendered
                if (!this.canRenderWholePage) {
                    return;
                }
                // if the whole page's worth of equations
                // are already rendered, don't render more
                if (this.pageRendered) {
                    return;
                }
                var topBound = this.lastRenderedTopEquation.getBoundingClientRect.top;
                var bottomBound = this.lastRenderedBottomEquation.getBoundingClientRect.bottom;
                var scrollTop, scrollBottom = getViewport();
                // if the user is about to scroll past the initially-rendered equations
                // we will render the whole page
                if (scrollTop - 50 + window.scrollY < topBound || scrollBottom + 50 + window.scrollY > bottomBound) {
                    console.log("Scrolled beyond!")
                    var article = document.querySelector(".post");
                    if (article) {
                        this.renderMath(article);
                    }
                    this.pageRendered = true;
                }
                
            }
            
        }

        function showTocBtnOnScroll() {
            // don't show toc button on print media
            if (window.matchMedia('print').matches){ return; }
            var _, scrollBottom = getViewport();
            // get bottom of viewport scroll position
            if (scrollBottom > tocPos) {
                tocBtn.style.display = "block";
            } else {
                tocBtn.style.display = "none";
            }
        }

        function findFirstRelevantElement() {
            // finds the first <p> tage that's closest to
            // the viewer's viewport
            var regex = /#.*/;
            var m = regex.exec(window.location.href);
            if (m !== null) {
                return document.querySelector(m[0]);
            } else {
                return document.querySelector(".post p");
            }
        }
        
        // initialize page JS components
        /*
        var mathRenderer = new VisibleMathRenderer({
            // start rendering with first <p> tag on the
            // post
            startElement: findFirstRelevantElement()
        });
        */
        document.addEventListener("DOMContentLoaded", function() {
            showTocBtnOnScroll();
            var article = document.querySelector(".post");
            if (article) {
                renderMath(article);
            }
        })

        window.onscroll = function(){
            // if (!mathRenderer.pageRendered) {
            //     mathRenderer.renderMathOnPage();
            // }
            showTocBtnOnScroll();
        };


    </script>
    


</body>

</html>
